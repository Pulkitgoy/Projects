"use strict";
var __create = Object.create;
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getProtoOf = Object.getPrototypeOf;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toESM = (mod, isNodeMode, target) => (target = mod != null ? __create(__getProtoOf(mod)) : {}, __copyProps(
  isNodeMode || !mod || !mod.__esModule ? __defProp(target, "default", { value: mod, enumerable: true }) : target,
  mod
));
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// src/index.ts
var src_exports = {};
__export(src_exports, {
  Channel: () => Channel,
  HNSClient: () => HNSClient,
  getClient: () => getClient,
  initClient: () => initClient
});
module.exports = __toCommonJS(src_exports);

// src/gql/graphql.ts
var import_graphql_request = require("graphql-request");
var Channel = /* @__PURE__ */ ((Channel2) => {
  Channel2["Email"] = "EMAIL";
  Channel2["Sms"] = "SMS";
  Channel2["WebPush"] = "WEB_PUSH";
  return Channel2;
})(Channel || {});
var AppFragmentFragmentDoc = import_graphql_request.gql`
  fragment AppFragment on App {
    id
    name
    apiKeyCreatedAt
    enabledOrigin
    active
    createdAt
    updatedAt
    hasApiKey
  }
`;
var NotificationFragmentFragmentDoc = import_graphql_request.gql`
  fragment NotificationFragment on Notification {
    id
    appId
    senderId
    typeId
    rawContent
    rawChannels
    replacements
    addedToQueueAt
    scheduledFor
    createdAt
    updatedAt
  }
`;
var NotificationRecipientFragmentFragmentDoc = import_graphql_request.gql`
  fragment NotificationRecipientFragment on NotificationRecipient {
    id
    notificationId
    userId
    sentAt
    readAt
    createdAt
    updatedAt
  }
`;
var NotificationTypeFragmentFragmentDoc = import_graphql_request.gql`
  fragment NotificationTypeFragment on NotificationType {
    id
    appId
    name
    description
    notificationCenterTitle
    notificationCenterBody
    notificationCenterIcon
    notificationCenterIcon
    emailTemplateSubject
    emailTemplateText
    emailTemplateHtmlPath
    tempEmailTemplateHtml
    smsTemplate
    webPushTemplate
    notificationCenterEnabled
    emailEnabled
    smsEnabled
    webPushEnabled
    active
    createdAt
    updatedAt
  }
`;
var PageInfoFragmentFragmentDoc = import_graphql_request.gql`
  fragment PageInfoFragment on PageInfo {
    hasPreviousPage
    hasNextPage
    startCursor
    endCursor
  }
`;
var UserChannelFragmentFragmentDoc = import_graphql_request.gql`
  fragment UserChannelFragment on UserChannel {
    id
    channel
    details
    active
    createdAt
    updatedAt
  }
`;
var UserFragmentFragmentDoc = import_graphql_request.gql`
  fragment UserFragment on User {
    id
    appId
    refId
    createdAt
    updatedAt
  }
`;
var CreateNotificationDocument = import_graphql_request.gql`
  mutation createNotification($data: CreateNotificationData!) {
    createNotification(data: $data) {
      ...NotificationFragment
      notificationType {
        id
        name
      }
    }
  }
  ${NotificationFragmentFragmentDoc}
`;
var CreateNotificationTypeDocument = import_graphql_request.gql`
  mutation createNotificationType($data: CreateNotificationTypeData!) {
    createNotificationType(data: $data) {
      ...NotificationTypeFragment
    }
  }
  ${NotificationTypeFragmentFragmentDoc}
`;
var CreateUserDocument = import_graphql_request.gql`
  mutation createUser($data: CreateUserData!) {
    createUser(data: $data) {
      ...UserFragment
      app {
        ...AppFragment
      }
      channels {
        ...UserChannelFragment
      }
    }
  }
  ${UserFragmentFragmentDoc}
  ${AppFragmentFragmentDoc}
  ${UserChannelFragmentFragmentDoc}
`;
var CreateUserChannelDocument = import_graphql_request.gql`
  mutation createUserChannel($data: CreateUserChannelData!) {
    createUserChannel(data: $data) {
      ...UserChannelFragment
    }
  }
  ${UserChannelFragmentFragmentDoc}
`;
var DeleteNotificationDocument = import_graphql_request.gql`
  mutation deleteNotification($id: ID!) {
    deleteNotification(id: $id)
  }
`;
var DeleteNotificationTypeDocument = import_graphql_request.gql`
  mutation deleteNotificationType($id: ID!) {
    deleteNotificationType(id: $id)
  }
`;
var DeleteUserDocument = import_graphql_request.gql`
  mutation deleteUser($id: ID, $refId: ID) {
    deleteUser(id: $id, refId: $refId)
  }
`;
var DeleteUserChannelDocument = import_graphql_request.gql`
  mutation deleteUserChannel($id: ID!) {
    deleteUserChannel(id: $id)
  }
`;
var GenerateUserTokenDocument = import_graphql_request.gql`
  mutation generateUserToken($id: ID, $refId: ID) {
    generateUserToken(id: $id, refId: $refId)
  }
`;
var GetNotificationDocument = import_graphql_request.gql`
  query getNotification($id: ID!) {
    notification(id: $id) {
      ...NotificationFragment
      notificationType {
        id
        name
      }
    }
  }
  ${NotificationFragmentFragmentDoc}
`;
var GetNotificationTypeDocument = import_graphql_request.gql`
  query getNotificationType($id: ID!) {
    notificationType(id: $id) {
      ...NotificationTypeFragment
    }
  }
  ${NotificationTypeFragmentFragmentDoc}
`;
var GetNotificationTypesDocument = import_graphql_request.gql`
  query getNotificationTypes(
    $after: String
    $before: String
    $first: Int
    $last: Int
    $revert: Boolean
    $sortBy: NotificationTypeSortByKeys
    $filters: NotificationTypeFilters
  ) {
    notificationTypes(
      after: $after
      before: $before
      first: $first
      last: $last
      revert: $revert
      sortBy: $sortBy
      filters: $filters
    ) {
      pageInfo {
        ...PageInfoFragment
      }
      edges {
        cursor
        node {
          ...NotificationTypeFragment
        }
      }
      nodes {
        ...NotificationTypeFragment
      }
    }
  }
  ${PageInfoFragmentFragmentDoc}
  ${NotificationTypeFragmentFragmentDoc}
`;
var GetNotificationTypesCountDocument = import_graphql_request.gql`
  query getNotificationTypesCount {
    notificationTypesCount
  }
`;
var GetNotificationsDocument = import_graphql_request.gql`
  query getNotifications(
    $after: String
    $before: String
    $first: Int
    $last: Int
    $revert: Boolean
    $sortBy: NotificationSortByKeys
    $filters: NotificationFilters
  ) {
    notifications(
      after: $after
      before: $before
      first: $first
      last: $last
      revert: $revert
      sortBy: $sortBy
      filters: $filters
    ) {
      pageInfo {
        ...PageInfoFragment
      }
      edges {
        cursor
        node {
          ...NotificationFragment
        }
      }
      nodes {
        ...NotificationFragment
        notificationType {
          id
          name
        }
      }
    }
  }
  ${PageInfoFragmentFragmentDoc}
  ${NotificationFragmentFragmentDoc}
`;
var GetNotificationsCountDocument = import_graphql_request.gql`
  query getNotificationsCount {
    notificationsCount
  }
`;
var GetUserDocument = import_graphql_request.gql`
  query getUser($refId: ID, $id: ID) {
    user(refId: $refId, id: $id) {
      ...UserFragment
      app {
        ...AppFragment
      }
      channels {
        ...UserChannelFragment
      }
    }
  }
  ${UserFragmentFragmentDoc}
  ${AppFragmentFragmentDoc}
  ${UserChannelFragmentFragmentDoc}
`;
var GetUserChannelDocument = import_graphql_request.gql`
  query getUserChannel($id: ID!) {
    userChannel(id: $id) {
      ...UserChannelFragment
    }
  }
  ${UserChannelFragmentFragmentDoc}
`;
var GetUserChannelsDocument = import_graphql_request.gql`
  query getUserChannels(
    $after: String
    $before: String
    $first: Int
    $last: Int
    $revert: Boolean
    $sortBy: UserChannelSortByKeys
    $filters: UserChannelFilters
  ) {
    userChannels(
      after: $after
      before: $before
      first: $first
      last: $last
      revert: $revert
      sortBy: $sortBy
      filters: $filters
    ) {
      pageInfo {
        ...PageInfoFragment
      }
      edges {
        cursor
        node {
          ...UserChannelFragment
        }
      }
      nodes {
        ...UserChannelFragment
      }
    }
  }
  ${PageInfoFragmentFragmentDoc}
  ${UserChannelFragmentFragmentDoc}
`;
var GetUserChannelsCountDocument = import_graphql_request.gql`
  query getUserChannelsCount {
    userChannelsCount
  }
`;
var GetUsersDocument = import_graphql_request.gql`
  query getUsers(
    $after: String
    $before: String
    $first: Int
    $last: Int
    $revert: Boolean
    $sortBy: UserSortByKeys
    $filters: UserFilters
  ) {
    users(
      after: $after
      before: $before
      first: $first
      last: $last
      revert: $revert
      sortBy: $sortBy
      filters: $filters
    ) {
      pageInfo {
        ...PageInfoFragment
      }
      edges {
        cursor
        node {
          ...UserFragment
        }
      }
      nodes {
        ...UserFragment
      }
    }
  }
  ${PageInfoFragmentFragmentDoc}
  ${UserFragmentFragmentDoc}
`;
var GetUsersCountDocument = import_graphql_request.gql`
  query getUsersCount($filters: UserFilters) {
    usersCount(filters: $filters)
  }
`;
var GetUsersWithCountDocument = import_graphql_request.gql`
  query getUsersWithCount(
    $after: String
    $before: String
    $first: Int
    $last: Int
    $revert: Boolean
    $sortBy: UserSortByKeys
    $filters: UserFilters
  ) {
    count: usersCount(filters: $filters)
    users(
      after: $after
      before: $before
      first: $first
      last: $last
      revert: $revert
      sortBy: $sortBy
      filters: $filters
    ) {
      pageInfo {
        ...PageInfoFragment
      }
      edges {
        cursor
        node {
          ...UserFragment
          channels {
            ...UserChannelFragment
          }
        }
      }
      nodes {
        ...UserFragment
        channels {
          ...UserChannelFragment
        }
      }
    }
  }
  ${PageInfoFragmentFragmentDoc}
  ${UserFragmentFragmentDoc}
  ${UserChannelFragmentFragmentDoc}
`;
var SaveUserDocument = import_graphql_request.gql`
  mutation saveUser($id: ID, $refId: ID, $data: SaveUserData!) {
    saveUser(id: $id, refId: $refId, data: $data) {
      ...UserFragment
      app {
        ...AppFragment
      }
      channels {
        ...UserChannelFragment
      }
    }
  }
  ${UserFragmentFragmentDoc}
  ${AppFragmentFragmentDoc}
  ${UserChannelFragmentFragmentDoc}
`;
var SendDocument = import_graphql_request.gql`
  mutation send($notification: CreateNotificationData, $notificationId: ID) {
    send(notification: $notification, notificationId: $notificationId) {
      ...NotificationFragment
      notificationType {
        id
        name
      }
    }
  }
  ${NotificationFragmentFragmentDoc}
`;
var UpdateNotificationTypeDocument = import_graphql_request.gql`
  mutation updateNotificationType($id: ID!, $data: UpdateNotificationTypeData!) {
    updateNotificationType(id: $id, data: $data) {
      ...NotificationTypeFragment
    }
  }
  ${NotificationTypeFragmentFragmentDoc}
`;
var UpdateUserDocument = import_graphql_request.gql`
  mutation updateUser($refId: ID!, $data: UpdateUserData!) {
    updateUser(refId: $refId, data: $data) {
      ...UserFragment
      app {
        ...AppFragment
      }
      channels {
        ...UserChannelFragment
      }
    }
  }
  ${UserFragmentFragmentDoc}
  ${AppFragmentFragmentDoc}
  ${UserChannelFragmentFragmentDoc}
`;
var UpdateUserChannelDocument = import_graphql_request.gql`
  mutation updateUserChannel($id: ID!, $data: UpdateUserChannelData!) {
    updateUserChannel(id: $id, data: $data) {
      ...UserChannelFragment
    }
  }
  ${UserChannelFragmentFragmentDoc}
`;
var defaultWrapper = (action, _operationName, _operationType) => action();
function getSdk(client, withWrapper = defaultWrapper) {
  return {
    createNotification(variables, requestHeaders) {
      return withWrapper(
        (wrappedRequestHeaders) => client.request(CreateNotificationDocument, variables, {
          ...requestHeaders,
          ...wrappedRequestHeaders
        }),
        "createNotification",
        "mutation"
      );
    },
    createNotificationType(variables, requestHeaders) {
      return withWrapper(
        (wrappedRequestHeaders) => client.request(CreateNotificationTypeDocument, variables, {
          ...requestHeaders,
          ...wrappedRequestHeaders
        }),
        "createNotificationType",
        "mutation"
      );
    },
    createUser(variables, requestHeaders) {
      return withWrapper(
        (wrappedRequestHeaders) => client.request(CreateUserDocument, variables, {
          ...requestHeaders,
          ...wrappedRequestHeaders
        }),
        "createUser",
        "mutation"
      );
    },
    createUserChannel(variables, requestHeaders) {
      return withWrapper(
        (wrappedRequestHeaders) => client.request(CreateUserChannelDocument, variables, {
          ...requestHeaders,
          ...wrappedRequestHeaders
        }),
        "createUserChannel",
        "mutation"
      );
    },
    deleteNotification(variables, requestHeaders) {
      return withWrapper(
        (wrappedRequestHeaders) => client.request(DeleteNotificationDocument, variables, {
          ...requestHeaders,
          ...wrappedRequestHeaders
        }),
        "deleteNotification",
        "mutation"
      );
    },
    deleteNotificationType(variables, requestHeaders) {
      return withWrapper(
        (wrappedRequestHeaders) => client.request(DeleteNotificationTypeDocument, variables, {
          ...requestHeaders,
          ...wrappedRequestHeaders
        }),
        "deleteNotificationType",
        "mutation"
      );
    },
    deleteUser(variables, requestHeaders) {
      return withWrapper(
        (wrappedRequestHeaders) => client.request(DeleteUserDocument, variables, {
          ...requestHeaders,
          ...wrappedRequestHeaders
        }),
        "deleteUser",
        "mutation"
      );
    },
    deleteUserChannel(variables, requestHeaders) {
      return withWrapper(
        (wrappedRequestHeaders) => client.request(DeleteUserChannelDocument, variables, {
          ...requestHeaders,
          ...wrappedRequestHeaders
        }),
        "deleteUserChannel",
        "mutation"
      );
    },
    generateUserToken(variables, requestHeaders) {
      return withWrapper(
        (wrappedRequestHeaders) => client.request(GenerateUserTokenDocument, variables, {
          ...requestHeaders,
          ...wrappedRequestHeaders
        }),
        "generateUserToken",
        "mutation"
      );
    },
    getNotification(variables, requestHeaders) {
      return withWrapper(
        (wrappedRequestHeaders) => client.request(GetNotificationDocument, variables, {
          ...requestHeaders,
          ...wrappedRequestHeaders
        }),
        "getNotification",
        "query"
      );
    },
    getNotificationType(variables, requestHeaders) {
      return withWrapper(
        (wrappedRequestHeaders) => client.request(GetNotificationTypeDocument, variables, {
          ...requestHeaders,
          ...wrappedRequestHeaders
        }),
        "getNotificationType",
        "query"
      );
    },
    getNotificationTypes(variables, requestHeaders) {
      return withWrapper(
        (wrappedRequestHeaders) => client.request(GetNotificationTypesDocument, variables, {
          ...requestHeaders,
          ...wrappedRequestHeaders
        }),
        "getNotificationTypes",
        "query"
      );
    },
    getNotificationTypesCount(variables, requestHeaders) {
      return withWrapper(
        (wrappedRequestHeaders) => client.request(GetNotificationTypesCountDocument, variables, {
          ...requestHeaders,
          ...wrappedRequestHeaders
        }),
        "getNotificationTypesCount",
        "query"
      );
    },
    getNotifications(variables, requestHeaders) {
      return withWrapper(
        (wrappedRequestHeaders) => client.request(GetNotificationsDocument, variables, {
          ...requestHeaders,
          ...wrappedRequestHeaders
        }),
        "getNotifications",
        "query"
      );
    },
    getNotificationsCount(variables, requestHeaders) {
      return withWrapper(
        (wrappedRequestHeaders) => client.request(GetNotificationsCountDocument, variables, {
          ...requestHeaders,
          ...wrappedRequestHeaders
        }),
        "getNotificationsCount",
        "query"
      );
    },
    getUser(variables, requestHeaders) {
      return withWrapper(
        (wrappedRequestHeaders) => client.request(GetUserDocument, variables, { ...requestHeaders, ...wrappedRequestHeaders }),
        "getUser",
        "query"
      );
    },
    getUserChannel(variables, requestHeaders) {
      return withWrapper(
        (wrappedRequestHeaders) => client.request(GetUserChannelDocument, variables, {
          ...requestHeaders,
          ...wrappedRequestHeaders
        }),
        "getUserChannel",
        "query"
      );
    },
    getUserChannels(variables, requestHeaders) {
      return withWrapper(
        (wrappedRequestHeaders) => client.request(GetUserChannelsDocument, variables, {
          ...requestHeaders,
          ...wrappedRequestHeaders
        }),
        "getUserChannels",
        "query"
      );
    },
    getUserChannelsCount(variables, requestHeaders) {
      return withWrapper(
        (wrappedRequestHeaders) => client.request(GetUserChannelsCountDocument, variables, {
          ...requestHeaders,
          ...wrappedRequestHeaders
        }),
        "getUserChannelsCount",
        "query"
      );
    },
    getUsers(variables, requestHeaders) {
      return withWrapper(
        (wrappedRequestHeaders) => client.request(GetUsersDocument, variables, { ...requestHeaders, ...wrappedRequestHeaders }),
        "getUsers",
        "query"
      );
    },
    getUsersCount(variables, requestHeaders) {
      return withWrapper(
        (wrappedRequestHeaders) => client.request(GetUsersCountDocument, variables, {
          ...requestHeaders,
          ...wrappedRequestHeaders
        }),
        "getUsersCount",
        "query"
      );
    },
    getUsersWithCount(variables, requestHeaders) {
      return withWrapper(
        (wrappedRequestHeaders) => client.request(GetUsersWithCountDocument, variables, {
          ...requestHeaders,
          ...wrappedRequestHeaders
        }),
        "getUsersWithCount",
        "query"
      );
    },
    saveUser(variables, requestHeaders) {
      return withWrapper(
        (wrappedRequestHeaders) => client.request(SaveUserDocument, variables, {
          ...requestHeaders,
          ...wrappedRequestHeaders
        }),
        "saveUser",
        "mutation"
      );
    },
    send(variables, requestHeaders) {
      return withWrapper(
        (wrappedRequestHeaders) => client.request(SendDocument, variables, { ...requestHeaders, ...wrappedRequestHeaders }),
        "send",
        "mutation"
      );
    },
    updateNotificationType(variables, requestHeaders) {
      return withWrapper(
        (wrappedRequestHeaders) => client.request(UpdateNotificationTypeDocument, variables, {
          ...requestHeaders,
          ...wrappedRequestHeaders
        }),
        "updateNotificationType",
        "mutation"
      );
    },
    updateUser(variables, requestHeaders) {
      return withWrapper(
        (wrappedRequestHeaders) => client.request(UpdateUserDocument, variables, {
          ...requestHeaders,
          ...wrappedRequestHeaders
        }),
        "updateUser",
        "mutation"
      );
    },
    updateUserChannel(variables, requestHeaders) {
      return withWrapper(
        (wrappedRequestHeaders) => client.request(UpdateUserChannelDocument, variables, {
          ...requestHeaders,
          ...wrappedRequestHeaders
        }),
        "updateUserChannel",
        "mutation"
      );
    }
  };
}

// src/utils/jwt.ts
var import_jsonwebtoken = __toESM(require("jsonwebtoken"));
async function generateJwt(apiKey, appId) {
  return new Promise((resolve, reject) => {
    const payload = {
      appId,
      iat: Math.floor(Date.now() / 1e3),
      aud: "app",
      random: Math.random(),
      exp: Math.floor(Date.now() / 1e3) + 86400
    };
    import_jsonwebtoken.default.sign(payload, apiKey, { algorithm: "HS256" }, (err, token) => {
      if (err) {
        reject(err);
      }
      resolve(token);
    });
  });
}

// src/client.ts
var import_graphql_request2 = require("graphql-request");
var DEFAULT_API_URL = process.env.HNS_API_URL || "https://hns-api.hyperting.com/graphql";
var HNSClient = class {
  constructor() {
    this._apiUrl = DEFAULT_API_URL;
    this._lastJwtGenerationTime = 0;
  }
  async generateJWT() {
    if (!this._apiKey) {
      throw new Error("API key is not set");
    }
    if (!this._appId) {
      throw new Error("App ID is not set");
    }
    this._jwt = await generateJwt(this._apiKey, this._appId);
    this._lastJwtGenerationTime = Date.now();
    if (!this._jwt) {
      throw new Error("Error while generating JWT token");
    }
    return this._jwt;
  }
  static getInstance() {
    if (this._instance) {
      return this._instance;
    }
    this._instance = new HNSClient();
    return this._instance;
  }
  async withToken(request) {
    if (!this.isInitialized()) {
      throw new Error("SDK is not initialized");
    }
    if (this.isJwtExpired()) {
      await this.generateJWT();
    }
    return {
      ...request,
      headers: { ...request.headers, Authorization: `Bearer ${this._jwt}` }
    };
  }
  init(config) {
    this._apiUrl = config.apiUrl || DEFAULT_API_URL;
    this._appId = config.appId;
    this._apiKey = config.apiKey;
    const client = new import_graphql_request2.GraphQLClient(this._apiUrl, {
      requestMiddleware: (request) => this.withToken(request)
    });
    this._sdk = getSdk(client);
    return this;
  }
  getSdk() {
    if (!this._sdk) {
      throw new Error("SDK is not initialized");
    }
    return this._sdk;
  }
  reset() {
    this._appId = void 0;
    this._apiKey = void 0;
    this._jwt = void 0;
    this._sdk = void 0;
  }
  isInitialized() {
    return !!this._appId && !!this._apiKey;
  }
  isJwtExpired() {
    return !this._jwt || this._lastJwtGenerationTime + 86400 * 1e3 < Date.now();
  }
};
function initClient(config) {
  return HNSClient.getInstance().init(config);
}
function getClient(noSdk) {
  if (noSdk) {
    return HNSClient.getInstance();
  }
  return HNSClient.getInstance().getSdk();
}
// Annotate the CommonJS export names for ESM import in node:
0 && (module.exports = {
  Channel,
  HNSClient,
  getClient,
  initClient
});
